app-id: com.gnome.dataguardian
runtime: org.gnome.Platform
runtime-version: "46"
sdk: org.gnome.Sdk
command: dataguardian.sh

finish-args:
  - --share=ipc
  - --device=all
  - --socket=x11
  - --socket=wayland
  - --filesystem=host
  - --filesystem=home
  - --share=network
  - --socket=session-bus  

modules:
  - name: dataguardian
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/GeovaneJefferson/dataguardian.git
        branch: main
      
    build-commands:
      # Create the main application directory
      - mkdir -p /app/share/dataguardian
      
      # Copy directories
      - cp -r src /app/share/dataguardian
      - cp -r data /app/share/dataguardian
      - cp -r share /app/share/dataguardian

      # Copy the .desktop files
      - mkdir -p /app/share/applications
      - cp -r share/applications/com.gnome.dataguardian.desktop /app/share/applications/
      
      # Copy icon to the appropriate location
      - mkdir -p /app/share/icons/hicolor/48x48/apps
      - cp -r data/icons/com.gnome.dataguardian.png /app/share/icons/hicolor/48x48/apps/

      # Copy the shell script
      - install -D -m755 dataguardian.sh -t /app/bin
      - install -D -m755 stop-daemon.sh -t /app/bin

      # Create the config directory in the app's runtime
      - mkdir -p /app/share/dataguardian/config

      # Copy AppStream metadata to the correct location
      # - mkdir -p /app/share/metainfo
      # - cp -r com.gnome.dataguardian.metainfo.xml /app/share/metainfo/
      
      # Install requirements 
      - pip3 install --prefix=/app -r requirements.txt
      
    build-options:
      build-args:
        - --share=network
    # sources:
    #   - type: git
    #     url: https://github.com/GeovaneJefferson/dataguardian.git
    #     commit: d309566b2f3d4de7b88589867e8568246ef91234e0e857545008d3288627ffee
    #   - type: file
    #     path: com.gnome.dataguardian.metainfo.xml
cleanup-commands:
  - /app/bin/stop-daemon.sh